{% extends 'product/base.html' %}
{% block title %}Gi·ªè h√†ng{% endblock %}

{% block content %}
<div class="container mt-4">
     <h2 class="mb-4">üõí Gi·ªè h√†ng</h2>

     {% if cart %}
     <!-- Form c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng -->
     <form method="post" action="{% url 'update_cart' %}">
          {% csrf_token %}

          <table class="table table-bordered align-middle">
               <thead class="table-light">
                    <tr>
                         <th>S·∫£n ph·∫©m</th>
                         <th class="text-center">S·ªë l∆∞·ª£ng</th>
                         <th>Gi√°</th>
                         <th>Th√†nh ti·ªÅn</th>
                         <th class="text-center">H√†nh ƒë·ªông</th>
                    </tr>
               </thead>
               <tbody>
                    {% for item in cart %}
                    <tr>
                         <td>
                              <strong>{{ item.product.name }}</strong><br>
                              <small class="text-muted">
                                   {{ item.product.category.name|default:"Kh√¥ng c√≥ danh m·ª•c" }}
                              </small>
                         </td>

                         <td class="text-center">
                              <input type="number" name="quantity_{{ item.product.id }}" value="{{ item.quantity }}"
                                   min="0" class="form-control form-control-sm text-center" style="width: 80px;">
                         </td>

                         <td>{{ item.price|floatformat:0 }}‚Ç´</td>
                         <td>{{ item.total_price|floatformat:0 }}‚Ç´</td>

                         <td class="text-center">
                              <!-- ‚úÖ Form xo√° RI√äNG bi·ªát -->
                              <form method="post" action="{% url 'remove_from_cart' item.product.id %}"
                                   style="display:inline;" onsubmit="return confirm('Xo√° s·∫£n ph·∫©m n√†y kh·ªèi gi·ªè?')">
                                   {% csrf_token %}
                                   <button type="submit" class="btn btn-sm btn-danger">‚ùå</button>
                              </form>
                         </td>
                    </tr>
                    {% endfor %}
               </tbody>
               <tfoot>
                    <tr>
                         <td colspan="3" class="text-end"><strong>T·ªïng ti·ªÅn:</strong></td>
                         <td colspan="2"><strong>{{ cart.get_total_price|floatformat:0 }}‚Ç´</strong></td>
                    </tr>
               </tfoot>
          </table>

          <div class="text-end">
               <button type="submit" class="btn btn-warning">üîÅ C·∫≠p nh·∫≠t gi·ªè h√†ng</button>
               <a href="{% url 'product_list' %}" class="btn btn-secondary">‚¨ÖÔ∏è Ti·∫øp t·ª•c mua h√†ng</a>
               <a href="{% url 'checkout' %}" class="btn btn-primary">üßæ Thanh to√°n</a>
          </div>
     </form>

     {% else %}
     <div class="alert alert-info">
          üõí Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng. <a href="{% url 'product_list' %}">Ti·∫øp t·ª•c mua s·∫Øm</a>.
     </div>
     {% endif %}
</div>
{% endblock %}